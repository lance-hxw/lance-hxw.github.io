
# 分布式一致性保证：如何解决多副本延迟和故障导致的数据同步问题
在多副本系统中，必定存在写的不一致（请求到达先后）
所以大部分的多副本数据系统都是提供最终一致性保证
- 即写完后， 等待足够长时间后，读的结果一致
- 即，所有不一致都是暂时的
最终一致性也可以叫作收敛性

但是最终一致性非常不好，因为不知道什么时候才收敛，所以完全无法和单线程应用一样进行开发。
在最终一致性保证下，开发全程需要注意系统限制，同时由于其在低负载下往往不会有问题，也更容易在线上出问题。

但是，强一致性也意味着低性能
这是一个trade off
实践中，往往用分层的策略，即：
- 底层解决可用性，性能和容量问题
- 上层解决一致性问题
或者提供多种一致性模型让用户取舍

# 线性一致性
线性一致性就是:
- 让系统就像只有一个数据副本一样
- 系统上的所有操作都可以原子完成
- 是最强一致性
- 或者叫:原子一致性, **强一致性**, 即时一致性,外部一致性
- 满足线性一致性的系统, 无论实际有多少副本, 应用层都可以不关心且轻松使用其功能.
- 保证数据最新，最近，是一种新鲜度保证

为什么说线性，如果两个请求并发，其中一个返回旧值还可以接受，如果后来请求返回了更旧的值，就完全不线性了，这是不能接受的

## 如何实现线性一致性

就是如何让他像单副本一样？

### 读写并发

每个请求都有开始和结束
读请求的取数据在这个区间的任一时刻
写请求的写入也在其区间的任一时刻

所以只要区间有交集，就是并发读写

### 问题的边界

在单副本系统中，显然应该保证：
- 没有写请求时，读都是最新数据
- 并发读写过程中可能新可能旧
同时还应该注意到， 在单副本系统中：
- 并发读写时，就算数据不是最新的，也不能交替不确定
- 可以理解为，任何时间都只有一个状态

这是很难的，由于时钟问题，分布式系统中“先后”的概念是不可靠的，这就导致了线性关系也不可靠

既然我们需要保证
“写操作中，必须有这样一个时间点，在这个时间点前系统读取结果是旧，这个时间点后，系统读取结果是新的”
- 这个性质我们可以称为“可见性”


