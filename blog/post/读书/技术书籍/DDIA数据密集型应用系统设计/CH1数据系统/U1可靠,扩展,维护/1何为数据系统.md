常见的抽象数据系统有：
- 数据库：存储数据
- 缓存：快速处理热点/重要数据
- 搜索引擎：检索和过滤
- 流式处理：源源不断的数据
- 批处理：定期处理累积数据
- 消息队列：消极传送和分发
但是目前的数据中间件复杂化，各种组件都不是单纯的形态
- kafka：可以存储数据，可以作为消息队列，可以流式处理
- spark：批处理，流式处理
- redis：缓存，也可以发布订阅称为事件中心
进而，当综合利用这些组件形成了新的数据系统，其功能更为复杂，其中架构涉及大量决策：
- 缓存策略？旁路还是写穿
- AP还是CP？
- 如果故障难以恢复，如何保证正确和完整
- 负载增加是增加机器还是增强性能
- API设计为简洁还是强大

一般的，可以将一个数据系统设计的考量从三个方面进行：
- 可靠性
- 可拓展性
- 可维护性
## 可靠性
可靠，指的是：
- 功能上：
	- 正常情况下，完成API功能
	- 用户错误操作：没有损失
- 性能上：给定硬件和数据量，满足性能指标
- 安全上：保证权限和防止恶意破坏

一般的，可以将造成错误的原因称为fault，此时就需要进行服务容错，容错也是在对这些fault进行
failure则是整体停止服务，一般的，fault累积或者爆发就会导致容错失效，服务failure
系统应该对fault进行容错，防止failure
一个关于容错的测试组件：netflex的chaosmonkey

### 可能出现的问题
- 硬件故障
	- 尤其是磁盘，有寿命，还需要raid
	- 如何解决：冗余
		- 形成集群后单点故障影响就小了，如何设计高性能集群才是重点
- 软件错误
	- 往往潜伏很久，触发原因是某种“假设”失效了
	- 解决：
		- 人脑思考场景
		- 测试，重启，监控
- 人为问题
	- 人不可靠，往往错误是运维配置错误
	- 解决：
		- 设计时：
			- 合理api
			- 隔离和解耦和
			- 对依赖设置服务熔断和降级
		- 测试， 监控，培训
## 可扩展性
应对负载增长的能力，但是很难实践中做好，因为只有存活的产品才会到这一步，而早期的拓展型设计会导致成本问题，让项目黄掉。
但是一些基本概念可以帮助尽可能减少挖坑
### 找合适的方法衡量负载量
### 负载量和硬件确定，如何描述性能
- 批处理：吞吐量
- 在线系统：响应时间（p50，p99.9）
注意应该测量client，防止头部阻塞和网络延迟对服务影响
### 应对负载
除了能直接优化的，一般需要扩展才能应对负载增长
- 垂直：直接更换更强大的机器
- 水平：多实例的分摊
此时又需要考虑拓展的时候是手动还是自动
- 手动：如果容易预测且不经常变化，设计简单
- 自动：难以预测经常变动，这样设计会复杂且容易资源浪费
一般来说，如果业务非常小，就用大机器，比较方便
其次可以考虑上云，利用云服务的扩展性
如果负载还是难以支持，需要自行设计可扩展的分布式架构。

在考虑分布式架构时，需要考虑服务设计类型：
- 无状态服务：多个机器，外面有个gateway就能组建集群
- 有状态服务：涉及分布式一致性问题
	- 需要根据读写情况，存储情况，访问模式等设计架构

注意：没有银弹
构成不同架构的原子设计是有限的，是难以满足一切需求的。

## 可维护
维护是软件生命周期中占比最大的，为了后续方便，需要考虑：
- 可维护：运维团队接手维护
	- 文档，自动化运维工具（监控，自检，报警）
	- 通用缺省配置
	- 自愈机制
	- 避免单点故障（人和机器都是）
- 简洁：新开发人员快速上手：这需要合理的抽象设计
	- 即复杂度管理
	- 复杂度来源
		- 状态空间
		- 组件耦合程度
		- 为了提升性能的hack
		- 编程规范和修改时的补丁
	- 额外复杂度
		- 实现有问题
	- 关键在于：给出合适的抽象，要么简洁，要么和“读者”达成共识（文档）
- 演化性：便于后续开发， 一般要求低耦合度
	- 项目管理上：敏捷开发
	- 系统设计上：合理抽象和封装（修改封闭，扩展开放）

