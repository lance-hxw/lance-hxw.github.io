
# 数据模型
应用就是层级化的数据模型组成的，
如何分析数据模型：
- 元素和元素的关系（一对多，多对多）
- 常用模型：关系模型（记录），文档模型（树状），图模型（复杂）
- schema？：强schema（写时约束）与弱schema（读解析）
	- 强schema一般性能好一些，弱schema读的时候复杂
好的数据模型应该：简洁直观，便于组合
## 关系模型
关系模型应该：
- 用关系表现数据
- 提供操作数据集合的关系算子
数据组织为：
- tuple，并集合成relations，即row和table
- “关系”是关系代数（集合论）的说法，即几个集合的笛卡尔积的子集
其最主要特点是schema，即声明式的描述和构建查询的方式
- 即查询和数据存储解耦，只要逻辑上进行集合操作就行
- 查询优化器可以利用不同的索引，并制定不同的查询方案
一般可以细分为：
- 事务型 TP：银行，车票
- 分析型 AP：数据报表，监控表盘
- 混合 HTAP
## 关系模型的缺点
nosql越来越常用，与关系型数据库不同，如mongo，redis， es， cassandra
nosql的主要优点是表达能力更强，关系型模型约束太严，限制太多，也难以支撑一些查询操作
nosql在实现上有性能优势与开源影响等

关系模型最大的问题是面向对象的嵌套的抽象与关系模型不匹配
关系模型处理一对多关系的时候就天然有复杂性，需要用外键
同时关系模型往往是强schema的，不够灵活，动态伸缩和扩展非常不方便
- 特别是一对多的时候，需要足够好的抽象和拆分
## 多对一和多对多的分析
关系模型最好处理简单的多对一，文档模型可以非常方便地处理多对一关系
多对多是更复杂的，基本需要join进行（或者应用侧实现）
这种关系的分析，主要有这些概念：
- id问题？数据-id的映射可以实现一个唯一的概念
	- 同时id由于没有实际意义，所以不怕变动
- 冗余问题：与数据库范式相关
## 文档模型
文档模型的显著优点是，可以用将嵌套的数据直接放在父节点中，不需要分出表来
不过就算处理方便，文档模型还是需要用外键（文档id）索引，并且需要join
## 对比
- 映射关系：
	- 文档：天然一对多
	- 关系：需要用外键+join处理一对多和多对多
- 映射难易程度：
	- 文档结构的就应该用文档，用关系会建模繁琐
- join：
	- 文档：不好
	- 关系：支持，但有难点
- 模式灵活度?
	- 文档：schema-on-read，灵活的动态增加字段
	- 关系：强schema，难以修改
- 访问局部性：
	- 文档：一次一个文档时很好，如果只是一个字段，就很差
		- 局部字段还是要加载整个文档
		- 一般会有优化，比如列存，或者嵌入表
			- 图模型中将电和出边放在一个机器上
	- 关系：一个复杂实体需要访问多个表，一个字段的话很好
## 文档和关系融合
现在pg和mysql都支持json了，有一些数据库还支持直接存表进去
- 但是文档数据库还是更广为使用（未知的恐惧
	- 同时mongo等的性能明显好（单表上亿
# 数据查询语言
如何分析查询语言？
- 如何与数据模型匹配和关联
- 声明 & 命令？
## 声明语言
描述控制逻辑而不是执行流程，如sql，css
高度抽象，解耦和，并且可以改进优化器来不断优化
执行的时候会让优化器生成执行计划，然后执行
多核优化空间大
## 命令语言
描述命令具体如何执行，用一系列语言不断变更数据状态
不抽象，强耦合
执行的时候直接生成中间代码，然后优化代码后就执行
难以为多核执行优化

## mapreduce：混合式
一开始来自google，现在mongo也类似：
- 声明：不定义数据集的遍历方式和shuffle等过程的逻辑
- 命令：需要针对如何处理单个数据
map和reduce两个函数精密结合
# 图模型
#TODO 
处理多对多关系非常方便