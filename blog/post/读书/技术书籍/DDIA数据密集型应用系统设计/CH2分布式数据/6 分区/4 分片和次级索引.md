分片都是基于主键的
那么在单独分片内, 主键索引还是生效的
但是在一个分片上建立次级索引就有问题.

次级索引的必要性:
- 如对主键分片, 但是需要加速name等字段的查询
- 搜索中使用倒排索引
- 不过kv中一般没有
# 建立次级索引的方式
- document-based
	- 即本地索引, 每个分片只处理本地有的document
- term-based 
	- 即全局索引, 每个分片中的索引都会出现全局的document
这是来自搜索的说法

## 本地索引
在每个分片上独立建立次级索引, 
- 写方便, 每次更新数据, 只更新本地的索引
### 本地次级索引的读:
- 如果将这个次级索引作为分片键的一部分, 效率就高, 否则就是遍历所有分片
- 每个分片内部基于次级索引查出主键, 然后在分片本地回表, 返回最终数据
本地索引使用非常广, mongo cassandra, es等都是用本地索引
## 全局索引
为了避免读的时候查所有分片,可以使用全局索引. 建立一个大的索引
- 然后为了避免这个大索引成为热点, 所以将索引也分片存到多个节点
此时的读:
- 这等于又维护了一个大索引然后又分散到各个分片上, 查询时, 要先找到key所在的分片, 将主键查出来, 再全局回表.
- 这个过程维护复杂, 如果要实现, 也得是异步更新索引, 会不一致, 或者使用分布式事务.


# 主键索引
主键索引一般都是聚簇索引, 所以主索引就是数据本身, 他肯定不包含本地分片外的东西, 但是他又不用自己维护全局信息, 分片路由肯定要基于主键维护.

每个分片上的主键索引就是一个单独的b+tree
