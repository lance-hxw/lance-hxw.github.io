redis读写都在内存中， 所以性能高， 但是当redis重启的时候，有些数据希望保持。
这就是redis持久化
# 两种持久化方式：AOF日志 / RDB快照
AOF：执行一次写，就将命令追加写到一个文件中：日志
RDB：将一个时刻的内存数据，用二进制写入磁盘：备份/快照

## AOF，append only File实现
每条写命令：
- 首先写内存
- 然后写日志到磁盘
写磁盘的策略有三种：
- Always：每次写后写日志
	- 可靠性最高，性能开销大
- EverySec：使用AOF文件的缓冲区，每秒刷一次缓冲区
	- 宕机丢一秒数据，性能适中
- No：redis不控制，让操作系统控制，持续写到缓冲区就行
	- 可靠性差，性能好
总的来说，AOF崩溃恢复，需要全量重放日志，开销很大
## RDB，redis database实现
有两个生成RDB文件的方式，save和bgsave
- save： 主线程生成RDB，会阻塞
- bgsave：创建一个子线程生成RDB
RDB生成瞬间全部内存数据， 崩溃恢复的效率比较高。

# AOF和RDB对比
数据安全性：
- AOF更安全，只会丢失一小段事件中 写操作的数据
- RDB快照间隔一般较长，期间如果有写操作，会丢数据
性能：
- AOF需要持续刷盘（除非用No策略），且文件很大， 重放很慢
	- 开always模式的时候，可能影响redis写性能
- RDB间隔比较久，且RDB文件小，备份和恢复都很快