gc是go的核心特性，因为需要调度大量goroutine
# 基本架构
并发三色标记-清理
过程：
- 初始标记，stw很短时间
	- 对root（全局变量，每个P上的全局栈，各个M的边界，找到直接可达对象，标记Gray
- 并发标记
	- 不断从Gray中取出对象，标记为Black，然后将其指向的未标记对象标记为Gray
	- 这个过程中，程序的读写操作都通过write barrier通知GC，将新对象标记为Gray
- 重新标记，stw很短时间
	- gray处理结束
	- 处理剩余未标记对象
- 并发清理
	- 对所有没有打黑色标记的对象，加入一个空闲列表，供分配
	- 将堆划分成mspan，这些span在过程中被逐个清扫 ，sweep后，没有使用的内存会被回收
这个过程：
- 低延迟
- 高吞吐
## 三色标记法
使用黑白灰三色，初始全部白色，标记过程用灰色标记，最终可达为黑色，标记结束后所有白色都可以清理

## write barrier
用于解决并发标记过程中，已经被标记为黑色的对象引用白色对象的情况
此时该黑色对象不会继续扫描，白色也不会

解决方案是写屏障，实现了若黑色对象引用新的白对象，立即将新对象标记成灰色

原理，基于同步hash：
- 对象写入指针前，判断是不是并发标记阶段
- 如果写入目标是黑色， 且写入对象是白色，就将写入对象变成灰色
开销：
- 少量cpu开销，但是不用长时间stw