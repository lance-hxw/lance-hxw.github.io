# 路由选择协议

划分：

- 能否自适应调整：静态路由选择和动态路由选择（自适应选择）
- 静态路由用于小网络，简单开销小；动态路由用于大网络

分层次的路由选择协议，网络很大，不需要让每台主机知道整个路由，故分层。同时有保密需要。

故分为小的自治系统AS，一个AS内选择策略统一。

- 可以有更多分层

## 内部网关协议IGP

一个自治系统内使用的路由选择策略;RIP,OSPF

域内路由选择

### RIP 基于距离向量的路由选择协议 简单

要求网络中的每一台路由器都要维护从他自己到其他每一个目的网络的距离记录，这一组距离即是一个向量；距离定义为：直连为1，每多一跳加1 。

RIP只用于小网络，当距离达到16时，认为不可达。

#### 特点

- RIP不允许多条路由，只选出一条最短路由，如果有更低时延的也不会选择
- 只和相邻路由器交换信息。
- 交换的信息是整个路由表
- 按固定的时间间隔交换路由信息。并更新自己的路由表
- 路由器刚刚开始工作时，路由表是空的，多次交换后，就知道整个网络中的路由信息。

#### 距离向量算法

- 根据接受到的报文更新
- 1，更新a到b的距离
- 2，更新下一跳是b的，从A到C的距离

#### 坏消息传播慢

不可达的检验要很长时间

### OSPF 开放最短路径优先

使用链路状态连接

- 每当发生变化时或隔一段时间，使用泛洪法发送更新信息。
- 泛洪法：向AS中所有路由器发送信息
- 信息：与本路由器相连的所有路由器链路状态，即有哪些路由器相邻。



OSPF允许多条路由，故可以实现负载均衡

特点：

- 定时刷新
- 通信量小
- 收敛快
- 计算复杂




#### 建立步骤

- 构造LSP，广播
- 根据收集的LSP建立数据库LSDB
- 使用SPF计算有源点的SPF树
- 建立到达所有信宿的路由表，端口和代价




## 外部网关协议EGP

不同AS间的路由选择;BGP-4

域间路由选择

### 边界网关协议BGP 

选出一条满足要求的路由，而不一定是最佳路由

使用路径向量路由选择协议

每个AS选出一个或多个发言人，发言人与其他AS的发言人建立TCP连接，利用传递BGP报文建立BGP会话，交换路由信息。

每个发言人需要运行BGp和AS内部网关协议

选择算法： 本地偏好，AS跳数最少，热土豆路由选择算法。
