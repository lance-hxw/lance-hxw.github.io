# 分层体系

## 五层协议分层

将协议分层,协议属于某一层,每一层可以利用其下的各层的服务,反之,每一层向上提供**服务**,即每一层的**服务模型**,他既可以使用下层的服务也可以利用自身的功能.

一个协议层可以用硬件和软件构成.

协议的两个问题是:

- 冗余的底层功能
- 层间不能完全分离(如果把信息提供出去,又在不必要的地方形成冗余)

这二者是矛盾的.

将协议层综合为**协议栈**.因特网的协议栈由五层构成:

- 物理层
- 链路层
- 网络层
- 运输层
- 应用层

这样排列是一个(down-top),学习时,使用(top-down approach),从应用层开始.

### 应用层

应用及其协议的留存地,如: http,smtp,ftp.

协议层分布在多个端系统上,不同端系统在应用层使用信息分组(**报文(message)**)传递信息.

### 运输层

运输层在应用程序的端系统间提供报文传送服务.

有两个运输协议:**TCP**和**UDP**.

tcp面向连接,确保传递和流量控制(发送/接收的速率匹配),将长报文分为短报文.
udp提供无连接服务,没有可靠性,没有流量控制,没有拥塞控制.

可以将运输层的分组称为**报文段(segment)**

### 网络层

网络层负责将**数据报(datagram)**的网络层分组在主机间移动.

运输层通过向网络层提供运输层 报文段 和目的地址,使用其提供的服务.

网络层有**IP**协议,定义了或得目的地址后,网络层部件如何处理.

还有路由选择协议,处理路由.

这一层又称为**IP层**,因为IP在此层有重要作用.

### 链路层

提供了在链路中节点间传递的服务,在每条边的起点,网络层将数据报下传链路层,传递到下一个节点后,再上传到网络层处理.

在网络层的一条路径上,可能经历多个不同的链路层,如wifi,以太网,电缆接入网等.

可以将链路层的分组称为**帧(frame)**

### 物理层

比链路层更底层的,关心bit传输的协议层,比如在网络层中接入网的组织需要物理层中同轴电缆和双绞铜线两种协议.


### 五层协议栈的总结

一个应用程序,处于应用层,他为用户提供报文传输的功能.为了完成这个服务,他将报文下传运输层.他抽象出**将报文在两个端系统间传递**这个服务,请求运输层的相应服务.

运输层将报文处理为报文段,解决了两个端系统间数据传输的规则,如tcp协议,为了完成整个任务,他抽象出**将一个报文段进行一次传递**这个服务,请求网络层的相应服务.

网络层通过如IP协议等协议,给出了数据报如何在网络间传递的方法,他抽象出**将数据报在节点间传递**这个服务,请求链路层的服务.

链路层规定了如何将帧在节点间传递,如wifi或者以太网协议,但他还需要抽象出**将bit在节点间传递**这个服务,请求物理层的服务.

物理层解决最后一个问题,比如在以太网中根据是双绞铜线还是同轴电缆给出不同的协议.

如此一个人类的需求抽象出的服务:**应用程序的一个网络功能**,处理分解为**将报文在端系统间传递**,进一步分解为**将报文段进行一次传递**,进而变成**将数据报在节点间传递**,最后变为**bit在节点间如何传递**这个问题并最终由物理层解决.


## OSI模型

这并非唯一的一种协议栈,iso也有7层表示,称为开放系统互联模型.

分为:应用,表示,会话,运输,网络,链路,物理7层.

额外的两个层:

- 表示层: 使得通信的应用程序能够解释交换数据的含义,如加密和数据描述(如格式)
- 会话层提供数据交换的边界和同步功能,包括建立检查点和恢复方案的方法.

## 封装

一个数据的传递可以看作每个节点协议栈的上上下下最后抵达接受端的协议栈.

在这个下降过程中,数据层层封装,在发送伊始,一个**应用层报文**下放运输层,被处理后(加上首部信息)成为**运输层报文段**,他就是由上层报文,加上附加信息,比如差错检验.

继续向下:网络层进一步封装为**网络层数据报**,他可能加上了源和目的端地址(这里开始才离开发送端),接下来是链路层,变为**链路层帧**...

所以,在每一层,一个分组都包含两部分:

- 首部字段,本层工作需要的附加信息,比如在网络层发送时要附加上源和目的地
- 有效载荷(payload field),一般来自上一层

# 简明总结

## 四层模型（TCP/IP模型）

1. 网络接口层（或链路层 / 网络访问层）arp
2. 网络层（Internet Layer）ip
3. 传输层（Transport Layer）tcp
4. 应用层（Application Layer）http

**特点：**
- 实际用于互联网的主流分层模型
- 比较简化，重在实际通信实现
## 五层模型（教科书模型）

1. 物理层
2. 数据链路层
3. 网络层
4. 传输层
5. 应用层
**特点：**
- 是对TCP/IP模型的细化
- 物理层、数据链路层分开，便于教学理解
- 常见于大学教材
## 七层模型（OSI参考模型）

1. 物理层
2. 数据链路层
3. 网络层
4. 传输层
5. 会话层
6. 表示层
7. 应用层
**特点：**
- 最完整、理论性最强
- 每层功能分得很细（如表示层、会话层），但实际应用不多
- 用于指导协议设计和理解网络通信

## 总结对比表

|层级|四层 (TCP/IP)|五层|七层 (OSI)|
|---|---|---|---|
|7|||应用层|
|6|||表示层|
|5|应用层|应用层|会话层|
|4|传输层|传输层|传输层|
|3|网络层|网络层|网络层|
|2|网络接口层|数据链路层|数据链路层|
|1||物理层|物理层|

- **4层模型**重实践，**5层模型**便于教学，**7层模型**重理论。
- 现实应用中**TCP/IP 4层**和**5层模型**用得最多。

## 协议所在层级

|协议|四层 (TCP/IP)|五层|七层 (OSI)|
|---|---|---|---|
|HTTP, HTTPS|应用层|应用层|应用层|
|FTP, SMTP, POP3|应用层|应用层|应用层|
|DNS|应用层|应用层|应用层|
|DHCP|应用层|应用层|应用层|
|SSH, Telnet|应用层|应用层|应用层|
|TLS/SSL|应用层（也可认为介于应用与传输层之间）|应用层/传输层|表示层/会话层/应用层|
|TCP, UDP|传输层|传输层|传输层|
|IP（IPv4/IPv6）|网络层|网络层|网络层|
|ICMP, IGMP|网络层|网络层|网络层|
|ARP, RARP|网络接口层|数据链路层|数据链路层|
|以太网(Ethernet)|网络接口层|数据链路层|数据链路层|
|Wi-Fi|网络接口层|数据链路层|数据链路层|
|PPP|网络接口层|数据链路层|数据链路层|
|光纤/电缆等物理传输|网络接口层|物理层|物理层|