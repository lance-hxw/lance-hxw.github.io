如果TCP报文中的数据非常小， 比如只有几个字节，那效率非常低
tcp头部就有20B
IP头部还有20B
下面还有链路层等
所以有两种策略用于提高效率

# Nagle算法
任意时刻，最多只有一个未被确认的小段
这很简单：
- 如果没有未被确认报文，正常发送一个数据包
- 存在未被确认报文，此时不允许发送小报文，必须要数据长度达到mss，才发送数据

TCP_NODELAY可以用于禁用nagle
# 延迟确认
ack如果没有数据可以携带，效率也非常低
所以可以延迟ack
- 如果有响应数据可以发送，发送带数据的ack
- 如果没有响应数据，延迟ack，等待是否有数据可以发送
- 如果延迟期间对方有报文到达，立即发送上一个ack
最多等待200ms这样，有上限的
linux中有tcp_delack_min（ms）用于控制延迟ack
# 同时使用？
不能，同时用延迟太大了，如果是稀疏的小数据传输，发送端那边会等待ack，另一边ack又在等待新数据，类似死锁了