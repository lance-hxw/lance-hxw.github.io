PPP协议是一种简单的、点对点的数据链路层协议

## 组成

- 一种将IP数据报封装到串行链路的方法。
- 一个用于建立、配置和测试数据链路连接的**链路控制协议LCP**
- 一套**网络控制协议NCP**： 对接网络层，每个协议支持不同的网络层协议（网络层不统一）

## PPP的帧格式

F | A | C | 协议 |IP 数据报 | FCS | F 
---|---|---|---|---|---|---
7E | FF | 03 |...|...|crc帧检验序列|7E
1B|1B|1B|2B|MTU限制|2B|1B

- A，C字段无意义
- 根据协议字段的不同，信息字段可能是IP数据报，也可能是LCP信息
- 信息字段不超过1500B
- 7E即：0x01111110，中间连续6个1
### 字节填充

在逐字符传输（异步传输）时：
使用7D作为转义字符，对三种类型信息段进行转义：
- 7E
- 7D
- ASCII中的控制字符

数据链路层封装和上传网络层时进行填充和恢复

### 零比特填充

在逐bit传递（同步传输） 时：
不考虑控制符（SONET/SDH协议中规定的不用考虑），只要避免终止/开始的误判即可：

- 对整个信息字段扫描，对连续5个1后加上0，恢复时对连续5个1后去掉一个0

这样就避免了在信息字段出现连续6个1（7E）

## PPP协议的工作状态

### 建立

- 用户拨号连入ISP，建立一条物理连接
- 用户电脑向ISP发送一系列LCP分组（多个PPP帧），建立LCP连接（数据链路层）。
- 网络层配置，NCP给新接入的用户分配一个临时IP地址，成为网络上的一个主机

### 结束

- 通信完毕，NCP释放网络层连接，收回IP
- LCP释放数据链路层连接
- 终止物理层连接


### 具体状态

- **初始状态**是链路静止，此时没有物理连接
- 当通过调制解调器呼叫路由时，建立物理连接，进入**链路建立**阶段，开始建立LCP连接，此时开始LCP协商，发送LCP的配置请求帧，其信息字段为特定的配置请求。链路的另一端可以发送响应帧：配置确认帧（所有选项都接受），配置否认帧（所有选项理解但不接受），配置拒绝帧（有的无法理解，需要协商）。需要配置的有帧长，鉴别协议等
- LCP连接后，进入**鉴别**状态，此时，只能传送LCP协议的分组，鉴别协议的分组和监测链路质量的的分组。若鉴别失败，进入**链路终止**状态，若成功，进入**网络层协议**状态。
- 在**网络层协议状态**，链路两段的NCP根据网络层的不同协议互相交换特定的网络控制分组，进行配置，配置内容包括不同网络层协议对接，以及压缩信息等。
- 网络层配置完毕，进入**链路打开**状态，此时两个PPP端点可以相互发送PPP分组，还可以发送回送LCP分组和回送回答LCP分组，检查链路状态。
- 一端可以发送终止请求LCP，在收到对方发送的终止确认LCP分组后，转入**链路终止**状态，如果连接过程出现故障也会转入。当调制解调器的载波停止后，进入**链路静止**状态。

以上，PPP设计数据链路层，网络层和物理层。



